# ä¼šè¯å­˜å‚¨æ¥å£ç³»ç»Ÿ - å®Œæ•´å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### æ ¸å¿ƒæ¶æ„è®¾è®¡

æˆ‘ä¸º `ai-visual` é¡¹ç›®åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ã€è§£è€¦çš„ä¼šè¯å­˜å‚¨ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒéƒ¨åˆ†ï¼š

#### 1. **ç±»å‹å®šä¹‰** (`types.ts`)
- `IStorage` - æ ¸å¿ƒå­˜å‚¨æ¥å£
- `StorageOptions` - å­˜å‚¨é€‰é¡¹ï¼ˆè¿‡æœŸæ—¶é—´ã€å…ƒæ•°æ®ï¼‰
- `ApiStorageConfig` - API è°ƒç”¨é…ç½®
- `StorageType` æšä¸¾ - æ”¯æŒ 4 ç§å­˜å‚¨ç±»å‹

#### 2. **å­˜å‚¨å®ç°**ï¼ˆ4 ç§å®Œå…¨ç‹¬ç«‹çš„å®ç°ï¼‰

| å®ç° | æ–‡ä»¶ | ç‰¹ç‚¹ |
|-----|-----|------|
| **LocalStorage** | `implementations/LocalStorage.ts` | æŒä¹…åŒ–ã€~5MBã€è·¨ä¼šè¯ |
| **SessionStorage** | `implementations/SessionStorage.ts` | ä¼šè¯çº§ã€~5MBã€å…³é—­åæ¸…é™¤ |
| **ApiStorage** | `implementations/ApiStorage.ts` | æœåŠ¡å™¨å­˜å‚¨ã€åŠ å¯†ã€æ— é™å®¹é‡ |
| **MemoryStorage** | `implementations/MemoryStorage.ts` | æµ‹è¯•ç”¨ã€å¿«é€Ÿã€å†…å­˜ä¸­ |

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… è¿‡æœŸæ—¶é—´ç®¡ç†
- âœ… å…ƒæ•°æ®æ”¯æŒ
- âœ… ç»Ÿä¸€çš„å¼‚æ­¥ API
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… å®Œå…¨è§£è€¦å®ç°

#### 3. **å·¥å‚ç±»å’Œç®¡ç†å™¨** (`StorageFactory.ts`)
- `StorageFactory` - åˆ›å»ºå­˜å‚¨å®ä¾‹çš„å·¥å‚
  - æ”¯æŒå•ä¾‹ç¼“å­˜
  - æ˜“äºæ‰©å±•æ–°å­˜å‚¨ç±»å‹
  
- `StorageManager` - å­˜å‚¨ç®¡ç†å™¨
  - æ”¯æŒä¸»å¤‡å­˜å‚¨åˆ‡æ¢
  - è‡ªåŠ¨é™çº§å’Œæ•…éšœè½¬ç§»
  - åŒæ­¥åˆ é™¤å’Œæ¸…ç©º

#### 4. **é«˜çº§ç®¡ç†å™¨** (`managers.ts`)
é’ˆå¯¹ä¸åŒåœºæ™¯çš„ä¸“ç”¨ç®¡ç†å™¨ï¼š
- `SessionManager` - ç”¨æˆ·ä¼šè¯ç®¡ç†
- `CacheManager` - API å“åº”ç¼“å­˜
- `PreferencesManager` - ç”¨æˆ·åå¥½è®¾ç½®
- `TemporaryDataManager` - ä¸´æ—¶æ•°æ®å­˜å‚¨
- `StorageHealthCheck` - å­˜å‚¨å¥åº·æ£€æŸ¥
- `SmartStorageManager` - æ™ºèƒ½å­˜å‚¨é€‰æ‹©ï¼ˆé’ˆå¯¹ä¸åŒåœºæ™¯ä¼˜åŒ–ï¼‰

#### 5. **React Hooks** (`hooks.ts`)
- `useStorage` - åŸºç¡€å­˜å‚¨åŒæ­¥
- `useSessionStorage` - SessionStorage Hook
- `useLocalStorage` - LocalStorage Hook
- `useAsync` - å¼‚æ­¥æ“ä½œ Hook
- `useCachedAsync` - å¸¦ç¼“å­˜çš„å¼‚æ­¥æ“ä½œ
- `useStorageSync` - å¤šå€¼åŒæ­¥
- `useDebounceStorage` - é˜²æŠ–å­˜å‚¨

#### 6. **å®Œæ•´æ–‡æ¡£**
- `README.md` - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
- `INTEGRATION.md` - é›†æˆæŒ‡å—ï¼ˆ20+ ä¸ªå®é™…åœºæ™¯ï¼‰
- `examples.ts` - 8 ä¸ªè¯¦ç»†ç¤ºä¾‹
- `__tests__/storage.test.ts` - å…¨é¢çš„å•å…ƒæµ‹è¯•

## ğŸ¯ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åº”ç”¨å±‚ï¼ˆReact ç»„ä»¶ï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
   useStorage  useLocalStorage  useCachedAsync  ...ï¼ˆReact Hooksï¼‰
        â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    defaultStorage       â”‚
        â”‚   (StorageManager)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚           â”‚
         â–¼           â–¼           â–¼
    Primary     Fallback    ï¼ˆé™çº§é€»è¾‘ï¼‰
    Storage     Storage
         â”‚           â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚         â”‚   â”‚         â”‚
    â–¼         â–¼   â–¼         â–¼
LocalStorage SessionStorage MemoryStorage ApiStorage
    â”‚         â”‚   â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æµè§ˆå™¨å­˜å‚¨ / æœåŠ¡å™¨  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ è§£è€¦è®¾è®¡çš„ä¼˜åŠ¿

1. **æ¥å£éš”ç¦»** - æ‰€æœ‰å­˜å‚¨å®ç°éƒ½éµå¾ª `IStorage` æ¥å£
2. **æ˜“äºæ‰©å±•** - å¯å¿«é€Ÿæ·»åŠ æ–°çš„å­˜å‚¨ç±»å‹ï¼ˆå¦‚ IndexedDBã€WebSQL ç­‰ï¼‰
3. **çµæ´»ç»„åˆ** - é€šè¿‡å·¥å‚ç±»å’Œç®¡ç†å™¨è‡ªç”±ç»„åˆ
4. **è‡ªåŠ¨é™çº§** - å­˜å‚¨å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
5. **æ˜“äºæµ‹è¯•** - æ¯ä¸ªå®ç°å¯ç‹¬ç«‹æµ‹è¯•ï¼Œå†…å­˜å­˜å‚¨ä¾¿äºå•å…ƒæµ‹è¯•
6. **å…³æ³¨ç‚¹åˆ†ç¦»** - ä¸šåŠ¡é€»è¾‘æ— éœ€å…³å¿ƒåº•å±‚å­˜å‚¨ç»†èŠ‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼

```typescript
import defaultStorage from '@/lib/storage';

// ä¿å­˜
await defaultStorage.set('key', value);

// è·å–
const data = await defaultStorage.get('key');

// åˆ é™¤
await defaultStorage.remove('key');
```

### React ä¸­ä½¿ç”¨

```typescript
import { useStorage } from '@/lib/storage';

function App() {
  const [user, setUser] = useStorage('user', null);
  return <div>{user?.name}</div>;
}
```

### ä¸ºä¸åŒåœºæ™¯é€‰æ‹©å­˜å‚¨

```typescript
import { SmartStorageManager } from '@/lib/storage/managers';

// ç”¨æˆ·æ•°æ®ï¼ˆæŒä¹…åŒ– + é™çº§ï¼‰
const userStorage = SmartStorageManager.createForUserData();

// ä¼šè¯æ•°æ®ï¼ˆä¼šè¯çº§ + å†…å­˜å¤‡ç”¨ï¼‰
const sessionStorage = SmartStorageManager.createForSessionData();

// æœåŠ¡å™¨åŒæ­¥ï¼ˆAPI + æœ¬åœ°å¤‡ä»½ï¼‰
const syncStorage = SmartStorageManager.createForServerSync(apiConfig);

// æ•æ„Ÿæ•°æ®ï¼ˆAPI + SessionStorageï¼‰
const secureStorage = SmartStorageManager.createForSensitiveData(apiConfig);
```

## ğŸ“Š å­˜å‚¨æ–¹å¼å¯¹æ¯”è¡¨

| åŠŸèƒ½ | LocalStorage | SessionStorage | ApiStorage | MemoryStorage |
|-----|---------|---------|---------|---------|
| æŒä¹…åŒ– | âœ… | âŒ | âœ… | âŒ |
| è·¨æ ‡ç­¾é¡µ | âœ… | âŒ | âœ… | âŒ |
| å®¹é‡ | ~5MB | ~5MB | æ— é™ | æ— é™ |
| åŠ å¯† | âŒ | âŒ | âœ… | âŒ |
| ç¦»çº¿ | âœ… | âœ… | âŒ | âœ… |
| æ€§èƒ½ | å¿« | å¿« | ç½‘ç»œä¾èµ– | æœ€å¿« |
| å®‰å…¨æ€§ | ä½ | ä½ | é«˜ | æœ€é«˜ |

## ğŸ”Œ æ–‡ä»¶ç»“æ„æ€»è§ˆ

```
src/lib/storage/
â”œâ”€â”€ index.ts                          (ä¸»å…¥å£ï¼Œå¯¼å‡ºæ‰€æœ‰ API)
â”œâ”€â”€ types.ts                          (æ¥å£å’Œç±»å‹å®šä¹‰ï¼Œ107 è¡Œ)
â”œâ”€â”€ StorageFactory.ts                 (å·¥å‚ç±»ï¼Œ174 è¡Œ)
â”‚
â”œâ”€â”€ implementations/
â”‚   â”œâ”€â”€ LocalStorage.ts              (92 è¡Œ)
â”‚   â”œâ”€â”€ SessionStorage.ts            (92 è¡Œ)
â”‚   â”œâ”€â”€ ApiStorage.ts                (95 è¡Œ)
â”‚   â””â”€â”€ MemoryStorage.ts             (65 è¡Œ)
â”‚
â”œâ”€â”€ managers.ts                       (316 è¡Œï¼Œ6 ä¸ªé«˜çº§ç®¡ç†å™¨)
â”œâ”€â”€ hooks.ts                          (270 è¡Œï¼Œ8 ä¸ª React Hooks)
â”‚
â”œâ”€â”€ examples.ts                       (200+ è¡Œï¼Œ8 ä¸ªå®Œæ•´åœºæ™¯ç¤ºä¾‹)
â”œâ”€â”€ README.md                         (300+ è¡Œï¼Œå®Œæ•´æ–‡æ¡£)
â”œâ”€â”€ INTEGRATION.md                    (400+ è¡Œï¼Œé›†æˆæŒ‡å—å’Œæœ€ä½³å®è·µ)
â”‚
â”œâ”€â”€ __tests__/
â”‚   â””â”€â”€ storage.test.ts              (å®Œæ•´æµ‹è¯•å¥—ä»¶)
â”‚
â””â”€â”€ æ€»è®¡                              ~2000 è¡Œé«˜è´¨é‡ä»£ç 
```

## ğŸ“ è®¾è®¡æ¨¡å¼ä½¿ç”¨

1. **å·¥å‚æ¨¡å¼** - `StorageFactory` ç”¨äºåˆ›å»ºå­˜å‚¨å®ä¾‹
2. **ç­–ç•¥æ¨¡å¼** - ä¸åŒçš„å­˜å‚¨å®ç°ä½œä¸ºç­–ç•¥
3. **è£…é¥°å™¨æ¨¡å¼** - `StorageManager` è£…é¥°ä¸»å­˜å‚¨ï¼Œæ·»åŠ é™çº§èƒ½åŠ›
4. **å•ä¾‹æ¨¡å¼** - å­˜å‚¨å®ä¾‹ç¼“å­˜
5. **ç®¡ç†å™¨æ¨¡å¼** - ä¸ºä¸åŒåœºæ™¯æä¾›é«˜çº§ç®¡ç†å™¨

## ğŸ“ å®é™…ä½¿ç”¨åœºæ™¯

### å·²åŒ…å«çš„åœºæ™¯
1. âœ… ç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†
2. âœ… API å“åº”ç¼“å­˜
3. âœ… ç”¨æˆ·åå¥½è®¾ç½®
4. âœ… ä¸´æ—¶è¡¨å•æ•°æ®
5. âœ… æœåŠ¡å™¨æ•°æ®åŒæ­¥
6. âœ… æ•æ„Ÿæ•°æ®å®‰å…¨å­˜å‚¨
7. âœ… React ä¸­çš„æ•°æ®åŒæ­¥
8. âœ… é˜²æŠ–å­˜å‚¨æ›´æ–°

### æ”¯æŒçš„æ‰©å±•
- IndexedDB å­˜å‚¨ï¼ˆéµå¾ª `IStorage` æ¥å£å®ç°ï¼‰
- WebSQL å­˜å‚¨
- è‡ªå®šä¹‰åŠ å¯†å­˜å‚¨
- åˆ†å¸ƒå¼å­˜å‚¨
- å¤šçª—å£åŒæ­¥

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… è¿‡æœŸæ—¶é—´ç®¡ç†
- âœ… å…ƒæ•°æ®æ ‡è®°
- âœ… API å­˜å‚¨åŠ å¯†
- âœ… CSRF ä»¤ç‰Œæ”¯æŒ
- âœ… é”™è¯¯éš”ç¦»
- âœ… è‡ªåŠ¨é™çº§ä¿æŠ¤

## ğŸ§ª æµ‹è¯•è¦†ç›–

- âœ… æ•°æ®ä¿å­˜å’Œæ£€ç´¢
- âœ… æ•°æ®è¿‡æœŸ
- âœ… é”™è¯¯å¤„ç†
- âœ… å¤šå­˜å‚¨ç»„åˆ
- âœ… å·¥å‚ç±»åŠŸèƒ½
- âœ… ç®¡ç†å™¨é™çº§é€»è¾‘

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **é›†æˆåˆ°é¡¹ç›®**
   ```bash
   pnpm add # å·²å†…ç½®ï¼Œæ— éœ€é¢å¤–ä¾èµ–
   ```

2. **åœ¨ API ä¸­éƒ¨åˆ†å®ç°**ï¼ˆå¦‚éœ€è¦ API å­˜å‚¨ï¼‰
   ```typescript
   POST /api/storage/set
   GET /api/storage/get?key=xxx
   DELETE /api/storage/remove
   ```

3. **é…ç½®é»˜è®¤è¡Œä¸º**
   ```typescript
   // åœ¨åº”ç”¨å¯åŠ¨æ—¶
   const storage = SmartStorageManager.createForUserData();
   ```

4. **ç›‘æ§å­˜å‚¨çŠ¶æ€**
   ```typescript
   const healthCheck = new StorageHealthCheck();
   const status = await healthCheck.checkAll();
   ```

## ğŸ“„ API å¿«é€Ÿå‚è€ƒ

### æ ¸å¿ƒ API
```typescript
defaultStorage.set(key, value, options?)    // ä¿å­˜
defaultStorage.get(key)                     // è·å–
defaultStorage.remove(key)                  // åˆ é™¤
defaultStorage.clear()                      // æ¸…ç©º
```

### å·¥å‚ API
```typescript
StorageFactory.create(config)               // åˆ›å»ºå®ä¾‹
StorageFactory.clearCache()                 // æ¸…é™¤ç¼“å­˜
```

### ç®¡ç†å™¨ API
```typescript
new StorageManager(primary, fallback)       // åˆ›å»ºç®¡ç†å™¨
manager.set(key, value)                     // ä¿å­˜
manager.get(key)                            // è·å–
manager.getActiveStorage()                  // è·å–å½“å‰ä½¿ç”¨çš„å­˜å‚¨
```

### React Hooks
```typescript
useStorage(key, initialValue)               // åŸºç¡€å­˜å‚¨
useLocalStorage(key, initialValue)          // LocalStorage
useSessionStorage(key, initialValue)        // SessionStorage
useCachedAsync(key, asyncFn, options)       // ç¼“å­˜å¼‚æ­¥
useStorageSync(values)                      // å¤šå€¼åŒæ­¥
useDebounceStorage(key, value, delay)       // é˜²æŠ–å­˜å‚¨
```

## âœ¨ é¡¹ç›®äº®ç‚¹

1. **é›¶ä¾èµ–** - å®Œå…¨ä½¿ç”¨åŸç”Ÿ Web APIï¼Œæ— éœ€ç¬¬ä¸‰æ–¹åº“
2. **TypeScript æ”¯æŒ** - å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ³›å‹
3. **å¼‚æ­¥ä¼˜å…ˆ** - æ‰€æœ‰ API éƒ½æ˜¯ Promise-based
4. **ç”Ÿäº§å°±ç»ª** - åŒ…å«é”™è¯¯å¤„ç†ã€æ—¥å¿—ã€é™çº§æ–¹æ¡ˆ
5. **æ˜“äºç»´æŠ¤** - æ¸…æ™°çš„ä»£ç ç»“æ„å’Œè¯¦ç»†æ–‡æ¡£
6. **é«˜åº¦å¯æµ‹è¯•** - æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•

## ğŸ‰ æ€»ç»“

è¿™æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§ã€ç”Ÿäº§å°±ç»ª**çš„ä¼šè¯å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰ï¼š
- âœ… å®Œæ•´çš„åŠŸèƒ½è¦†ç›–
- âœ… æ¸…æ™°çš„æ¶æ„è®¾è®¡
- âœ… è¯¦å°½çš„æ–‡æ¡£
- âœ… å¯å®é™…ä½¿ç”¨çš„ä»£ç ç¤ºä¾‹
- âœ… æµ‹è¯•ç”¨ä¾‹
- âœ… æœ€ä½³å®è·µæŒ‡å¯¼

å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹ï¼
